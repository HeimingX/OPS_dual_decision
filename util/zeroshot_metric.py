# transform zero-shot setting metric 


# pq_unk, sq_unk, rq_unk, pq_uns, sq_uns, rq_uns
original_metric = [
    [28.0054,80.1724,34.9315,5.5967,80.8623,6.9212], # 0.99
    [26.6736,80.0377,33.3263,5.8878,79.6372,7.3933], # 0.97
    [27.7705,80.1502,34.6480,6.4186,82.4795,7.7821], # 0.95
    [28.6245,79.6223,35.9503,5.6957,82.7171,6.8858], # 0.9
    [27.1461,79.2737,34.2436,5.5850,82.1748,6.7965], # 0.89
    [28.8532,79.5292,36.2800,5.9040,84.5586,6.9822], # 0.88
    [21.2028,77.6023,27.3224,4.1774,80.3629,5.1981], # 0.85
]

# tp_unk, fp_unk, fn_unk, tp_uns, fp_uns, fn_uns
original_stats = [
    [816, 1122, 1918, 87 , 1122, 1218], # 0.99         
    [791, 1222, 1943, 97 , 1222, 1208], # 0.97
    [817, 1165, 1917, 100, 1165, 1205], # 0.95
    [854, 1163, 1880, 88 , 1163, 1217], # 0.9
    [859, 1424, 1875, 96 , 1424, 1209], # 0.89
    [868, 1183, 1866, 90 , 1183, 1215], # 0.88
    [825, 2480, 1909, 101, 2480, 1204], # 0.85
]

unk_uns_inst_ratio = 0.6769     #87+1218 : 816+1918

final_metric = list()
for i in range(len(original_stats)):
    _metric = original_metric[i]
    _stats = original_stats[i]

    _, sq_unk, _, _, sq_uns, _ = _metric
    tp_unk, fp, fn_unk, tp_uns, _, fn_uns = _stats

    fp_unk = int(fp * unk_uns_inst_ratio)
    fp_uns = fp - fp_unk

    recall_unk = tp_unk / (tp_unk + fn_unk)
    precision_unk = tp_unk / (tp_unk + fp_unk)
    rq_unk = tp_unk / (tp_unk + 0.5 * fp_unk + 0.5 * fn_unk) * 100
    rq_uns = tp_uns / (tp_uns + 0.5 * fp_uns + 0.5 * fn_uns) * 100

    pq_unk = rq_unk * sq_unk / 100
    pq_uns = rq_uns * sq_uns / 100

    final_metric.append([pq_unk, pq_uns])

print(final_metric)
# final_metric output
# [
#     [30.364668554188906, 8.017116923076923],  # 0.99
#     [29.09458671875, 8.597449526989427],      # 0.97
#     [30.183320304217556, 9.25695847362514],   # 0.95
#     [31.084545919999996, 8.229626681741097],  # 0.9
#     [29.892936040386306, 8.473448764769067],  # 0.89
#     [31.36362816901408, 8.560488188976379],   # 0.88
#     [24.449836738590797, 7.352040670289855]   # 0.85
# ]






